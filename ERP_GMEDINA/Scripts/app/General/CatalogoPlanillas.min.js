var pathname=window.location.pathname+"/",URLactual=window.location.toString(),getUrl=window.location,baseUrl=getUrl.protocol+"//"+getUrl.host+"/"+getUrl.pathname.split("/")[1],table;const btnGuardar="#btnGuardarCatalogoDePlanillasIngresosDeducciones",btnEditar="#btnEditarCatalogoDePlanillasIngresosDeducciones",validacionDescripcionPlanilla=$("#validacionDescripcionPlanilla"),validacionFrecuenciaDias=$("#validacionFrecuenciaDias"),validacionCatalogoIngresos=$("#catalogoDeIngresos #validacionCatalogoIngresos"),htmlBody=$("html, body"),validacionCatalogoDeducciones=$("#catalogoDeDeducciones #validacionCatalogoDeducciones"),inputDescripcionPlanilla=$("#cpla_DescripcionPlanilla"),inputFrecuenciaEnDias=$("#cpla_FrecuenciaEnDias"),inputIdPlanilla=$("form #cpla_IdPlanilla");function _ajax(params,uri,type,callback,enviar){$.ajax({url:uri,type:type,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(params),beforeSend:function(){enviar()},success:function(data){callback(data)}})}function spinner(){return'<div class="sk-spinner sk-spinner-wave">\n                <div class="sk-rect1"></div>\n                <div class="sk-rect2"></div>\n                <div class="sk-rect3"></div>\n                <div class="sk-rect4"></div>\n                <div class="sk-rect5"></div>\n             </div>'}function scrollArriba(){htmlBody.animate({scrollTop:200},300)}function listar(){obtenerIdDetallesEditar("#tblCatalogoPlanillas tbody",table=$(".dataTables-example").DataTable({destroy:!0,ajax:{method:"GET",url:"CatalogoDePlanillas/getPlanilla",contentType:"application/json; charset=utf-8",dataType:"json"},columns:[{className:"details-control",orderable:!1,data:null,defaultContent:""},{data:"descripcionPlanilla"},{data:"frecuenciaDias"},{defaultContent:'\n                        <button type="button" class="btn btn-primary btn-xs" id="btnEditarCatalogoDeducciones">Editar</button>\n                        <button type="button" class="btn btn-default btn-xs" id="btnDetalleCatalogoDeducciones">Detalle</button>\n                    '}],language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"},responsive:!1,pageLength:25,dom:'<"html5buttons"B>lTfgitp',buttons:[{extend:"copy"},{extend:"csv"},{extend:"excel",title:"ExampleFile"},{extend:"pdf",title:"ExampleFile"},{extend:"print",customize:function(win){$(win.document.body).addClass("white-bg"),$(win.document.body).css("font-size","10px"),$(win.document.body).find("table").addClass("compact").css("font-size","inherit")}}]}))}function obtenerIdDetallesEditar(tbody,table){"//"==pathname&&(pathname=baseUrl),pathname.toString().indexOf("CatalogoDePlanillas")<1&&(pathname+="CatalogoDePlanillas/"),$(tbody).on("click","button#btnEditarCatalogoDeducciones",(function(){var data=table.row($(this).parents("tr")).data();location.href=pathname+"Edit/"+data.idPlanilla})),$(tbody).on("click","button#btnDetalleCatalogoDeducciones",(function(){var data=table.row($(this).parents("tr")).data();location.href=pathname+"Details/"+data.idPlanilla}))}function getIngresos(data){var ingresosPlanillas='\n    <div class="col-lg-6">\n       <div class="ibox-title">\n            <h5>Ingresos de la Planilla</h5>\n        </div>\n        <div class="ibox-content">\n            <table class="table table-bordered">\n                <thead>\n                    <tr>\n                        <th>Ingreso</th>\n                    </tr>\n                </thead>\n                <tbody>';return $.each(data.ingresos,(function(index,val){ingresosPlanillas+="\n                        <tr>\n                            <td>\n                                "+val.cin_DescripcionIngreso+"\n                            </td>\n                        </tr>\n                    "})),ingresosPlanillas+="</tbody>\n            </table>\n        </div>\n    </div>"}function getDeducciones(data){var deduccionesPlanilla='\n    <div class="col-lg-6">\n       <div class="ibox-title">\n            <h5>Deducciones de la Planilla</h5>\n        </div>\n        <div class="ibox-content">\n            <table class="table table-bordered">\n                <thead>\n                    <tr>\n                        <th>Deducción</th>\n                    </tr>\n                </thead>\n                <tbody>';return $.each(data.deducciones,(function(index,val){deduccionesPlanilla+="\n                        <tr>\n                            <td>\n                                "+val.cde_DescripcionDeduccion+"\n                            </td>\n                        </tr>\n                    "})),deduccionesPlanilla+="</tbody>\n            </table>\n        </div>\n    </div>"}function obtenerDetalles(id,handleData){_ajax(null,"/CatalogoDePlanillas/getDeduccionIngresos/"+id,"GET",data=>handleData(data),()=>{console.log("Enviando...")})}function verificarCampos(descripcionPlanilla,frecuenciaDias,catalogoIngresos,catalogoDeducciones){var todoBien=!0;return""==descripcionPlanilla?(scrollArriba(),validacionDescripcionPlanilla.show(),todoBien=!1):validacionDescripcionPlanilla.hide(),""==frecuenciaDias||parseInt(frecuenciaDias)<=0?(scrollArriba(),validacionFrecuenciaDias.show(),todoBien=!1):validacionFrecuenciaDias.hide(),0==catalogoIngresos.length?(scrollArriba(),validacionCatalogoIngresos.show(),todoBien=!1):validacionCatalogoIngresos.hide(),0==catalogoDeducciones.length?(scrollArriba(),validacionCatalogoDeducciones.show(),todoBien=!1):validacionCatalogoDeducciones.hide(),todoBien}$(document).ready(()=>{getUrl.toString().indexOf("Create")<1&&getUrl.toString().indexOf("Edit")<1&&listar(),inputDescripcionPlanilla.blur((function(){""!=$(this).val()?validacionDescripcionPlanilla.hide():validacionDescripcionPlanilla.show()})),inputFrecuenciaEnDias.blur((function(){""!=inputFrecuenciaEnDias.val()&&inputFrecuenciaEnDias.val()>=0?validacionFrecuenciaDias.hide():validacionFrecuenciaDias.show()}))}),$(document).on("click","td.details-control",(function(){var tr=$(this).closest("tr"),row=table.row(tr);row.child.isShown()?(row.child.hide(),tr.removeClass("shown")):(row.child([spinner()]).show(),tr.addClass("shown"),obtenerDetalles(row.data().idPlanilla,data=>{row.child([getIngresos(data)+getDeducciones(data)]).show(),tr.addClass("shown")},()=>{}))})),getUrl.toString().indexOf("Create")>1&&($('input[type="checkbox"]').prop("checked",!1),inputDescripcionPlanilla.val(""),inputFrecuenciaEnDias.val("")),$(document).on("click",btnGuardar,(function(){crearEditar()})),$(document).on("click",btnEditar,(function(){crearEditar("edit")}));var crearEditar=function(edit){var arrayIngresos=[],arrayDeducciones=[],descripcionPlanilla=inputDescripcionPlanilla.val(),frecuenciaDias=inputFrecuenciaEnDias.val(),idPlanilla=inputIdPlanilla.val();$('#catalogoDeIngresos input[type="checkbox"]').each((function(index,val){let checkId,arr,currentCheckboxIdIngreso=$(val).attr("id").split("-")[1],isChecked;$("#catalogoDeIngresos #check-"+currentCheckboxIdIngreso).is(":checked",!0)&&arrayIngresos.push(currentCheckboxIdIngreso)})),$('#catalogoDeDeducciones input[type="checkbox"]').each((function(index,val){let checkIdDedu,arrDedu,currentCheckboxIdDedu=$(val).attr("id").split("-")[1],isCheckedDedu;!0===$("#catalogoDeDeducciones #check-"+currentCheckboxIdDedu).is(":checked",!0)&&arrayDeducciones.push(currentCheckboxIdDedu)})),verificarCampos(descripcionPlanilla,frecuenciaDias,arrayIngresos,arrayDeducciones)&&("edit"!=edit?_ajax({catalogoDePlanillas:[descripcionPlanilla,frecuenciaDias],catalogoIngresos:arrayIngresos,catalogoDeducciones:arrayDeducciones},"/CatalogoDePlanillas/Create","POST",data=>{"bien"==data?(iziToast.success({title:"Exito",message:"El registro fue insertado de forma exitosa."}),location.href=baseUrl):iziToast.error({title:"Error",message:"Hubo un error al insertar el registro"})},enviar=>{console.log("Enviando...")}):_ajax({id:idPlanilla,catalogoDePlanillas:[descripcionPlanilla,frecuenciaDias],catalogoIngresos:arrayIngresos,catalogoDeducciones:arrayDeducciones},"/CatalogoDePlanillas/Edit","POST",data=>{"bien"==data?(iziToast.success({title:"Exito",message:"El registro fue editado de forma exitosa."}),location.href=baseUrl):iziToast.error({title:"Error",message:"Hubo un error al editar el registro"})},enviar=>console.log("Enviando...")))};$("#inactivar").click(()=>{$("#InactivarCatalogoDeducciones").modal()}),$("#InactivarCatalogoDeducciones #btnInactivarPlanilla").click(()=>{var id;_ajax({id:inputIdPlanilla.val()},"/CatalogoDePlanillas/Delete","POST",data=>{"bien"==data?(iziToast.success({title:"Exito",message:"El registro fue inactivado de forma exitosa."}),location.href=baseUrl):iziToast.error({title:"Error",message:"Ocurrió un error"})},enviar=>{console.log("Enviando...")})});